# A2A Protocol Test Scenarios

scenarios:
  # Agent Card Discovery
  - name: agent_card_discovery
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: get_agent_card
        op: AgentCard
        input: {}
        expect:
          status: success
          result:
            protocolVersion: "1.0"
            name: "test_agent"
            capabilities:
              streaming: true
            skills:
              - id: "test_tools.echo"
                name: "echo"
              - id: "test_tools.add_numbers"
                name: "add_numbers"
              - id: "test_tools.process_data"
                name: "process_data"
              - id: "test_tools.validate_input"
                name: "validate_input"

  # Task Send - Basic
  - name: task_send_basic
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: send_task
        op: TasksSend
        input:
          id: "task-001"
          message:
            role: "user"
            parts:
              - type: "text"
                text: "Hello, agent!"
        expect:
          status: success
          result:
            id: "task-001"
            status:
              state: "completed"

  # Task Send - With Data Part
  - name: task_send_with_data
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: send_task_data
        op: TasksSend
        input:
          id: "task-002"
          message:
            role: "user"
            parts:
              - type: "data"
                data:
                  action: "process"
                  items: ["a", "b", "c"]
        expect:
          status: success
          result:
            id: "task-002"
            status:
              state: "completed"

  # Task Send Subscribe - Streaming
  - name: task_send_subscribe_streaming
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: send_subscribe
        op: TasksSendSubscribe
        headers:
          Accept: text/event-stream
        input:
          id: "task-003"
          message:
            role: "user"
            parts:
              - type: "text"
                text: "Stream this request"
        stream_expect:
          min_events: 2
          events:
            - event: status
              data:
                taskId: "task-003"
                status:
                  state: "working"
            - event: status
              data:
                taskId: "task-003"
                status:
                  state: "completed"
                final: true

  # Task Get - Existing Task
  - name: task_get_existing
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: send_task_first
        op: TasksSend
        input:
          id: "task-get-001"
          message:
            role: "user"
            parts:
              - type: "text"
                text: "Create task for get test"
        expect:
          status: success
      - name: get_task
        op: TasksGet
        input:
          id: "task-get-001"
        expect:
          status: success
          result:
            id: "task-get-001"

  # Task Get - Non-existent Task
  - name: task_get_not_found
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: get_missing_task
        op: TasksGet
        input:
          id: "non-existent-task"
        expect:
          status: success
          result:
            id: "non-existent-task"
            status:
              state: "failed"

  # Task Cancel
  - name: task_cancel
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: cancel_task
        op: TasksCancel
        input:
          id: "task-cancel-001"
        expect:
          status: success
          result:
            id: "task-cancel-001"
            status:
              state: "canceled"

  # Error Handling - Missing Message
  - name: task_send_missing_message
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: send_without_message
        op: TasksSend
        input:
          id: "task-error-001"
        expect:
          status: error
          error:
            code: -32602

  # Error Handling - Invalid Message Format
  - name: task_send_invalid_message
    defaults:
      client: jsonrpc.a2a_test_agent
    steps:
      - name: send_invalid
        op: TasksSend
        input:
          id: "task-error-002"
          message:
            role: "user"
            parts: "not-an-array"
        expect:
          status: error
          error:
            code: -32602
