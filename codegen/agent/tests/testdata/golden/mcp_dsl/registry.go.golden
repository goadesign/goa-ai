// Code generated by goa vX, DO NOT EDIT.
//
// ScribeAgent registry
//
// Command:

package scribe

import (
	"context"
	"errors"
	"fmt"
	core "goa.design/goa-ai/alpha/agents/scribe/core"
	"goa.design/goa-ai/runtime/agent/engine"
	"goa.design/goa-ai/runtime/agent/planner"
	agentsruntime "goa.design/goa-ai/runtime/agent/runtime"
	"time"
)

// RegisterScribeAgent registers the generated agent components with the runtime.
func RegisterScribeAgent(ctx context.Context, rt *agentsruntime.Runtime, cfg ScribeAgentConfig) error {
	if rt == nil {
		return errors.New("runtime is required")
	}
	agent, err := NewScribeAgent(cfg)
	if err != nil {
		return err
	}
	if err := rt.RegisterAgent(ctx, agentsruntime.AgentRegistration{
		ID:      "alpha.scribe",
		Planner: agent.Planner,
		Workflow: engine.WorkflowDefinition{
			Name:      "alpha.scribe.workflow",
			TaskQueue: "alpha_scribe_workflow",
			Handler:   agentsruntime.WorkflowHandler(rt),
		},
		Activities: []engine.ActivityDefinition{
			{
				Name:    "alpha.scribe.plan",
				Handler: agentsruntime.PlanStartActivityHandler(rt),
				Options: engine.ActivityOptions{
					Queue:   "alpha_scribe_workflow",
					Timeout: time.Duration(120000000000),
					RetryPolicy: engine.RetryPolicy{
						MaxAttempts:        3,
						InitialInterval:    time.Duration(1000000000),
						BackoffCoefficient: 2,
					},
				},
			},
			{
				Name:    "alpha.scribe.resume",
				Handler: agentsruntime.PlanResumeActivityHandler(rt),
				Options: engine.ActivityOptions{
					Queue:   "alpha_scribe_workflow",
					Timeout: time.Duration(120000000000),
					RetryPolicy: engine.RetryPolicy{
						MaxAttempts:        3,
						InitialInterval:    time.Duration(1000000000),
						BackoffCoefficient: 2,
					},
				},
			},
			{
				Name:    "alpha.scribe.executetool",
				Handler: agentsruntime.ExecuteToolActivityHandler(rt),
				Options: engine.ActivityOptions{},
			},
		},
		PlanActivityName: "alpha.scribe.plan",
		PlanActivityOptions: engine.ActivityOptions{
			Queue:   "alpha_scribe_workflow",
			Timeout: time.Duration(120000000000),
			RetryPolicy: engine.RetryPolicy{
				MaxAttempts:        3,
				InitialInterval:    time.Duration(1000000000),
				BackoffCoefficient: 2,
			},
		},
		ResumeActivityName: "alpha.scribe.resume",
		ResumeActivityOptions: engine.ActivityOptions{
			Queue:   "alpha_scribe_workflow",
			Timeout: time.Duration(120000000000),
			RetryPolicy: engine.RetryPolicy{
				MaxAttempts:        3,
				InitialInterval:    time.Duration(1000000000),
				BackoffCoefficient: 2,
			},
		},
		ExecuteToolActivity: "alpha.scribe.executetool",
		Specs:               nil,
		Policy:              agentsruntime.RunPolicy{},
	}); err != nil {
		return err
	}
	// Register external MCP toolsets using local executors and callers from config.
	if cfg.MCPCallers == nil {
		return fmt.Errorf("mcp callers are required for agent %s", "alpha.scribe")
	}
	{
		caller := cfg.MCPCallers[ScribeCalcCoreToolsetID]
		if caller == nil {
			return fmt.Errorf("mcp caller for %s is required", ScribeCalcCoreToolsetID)
		}
		exec := core.NewScribeCoreMCPExecutor(caller)
		// Build a runtime ToolsetRegistration inline to avoid exposing method/service adapters.
		reg := agentsruntime.ToolsetRegistration{
			Name: "calc.core",
			// Provide the agent-wide specs; runtime de-duplicates tool specs across registrations.
			Specs: specs.Specs,
			Execute: func(ctx context.Context, call planner.ToolRequest) (planner.ToolResult, error) {
				return exec.Execute(ctx, agentsruntime.ToolCallMeta{}, call)
			},
		}
		if err := rt.RegisterToolset(reg); err != nil {
			return err
		}
	}

	// Service toolsets are registered by application code using executors.
	return nil
}

