// Code generated by goa vX, DO NOT EDIT.
//
// ScribeAgent tool union types
//
// Command:

package union

import (
	"encoding/json"
	"fmt"
	goa "goa.design/goa/v3/pkg"
)

// Value is a sum-type union.
type Value struct {
	kind   ValueKind
	Number ValueNumber
	Text   ValueText
}

// ValueKind enumerates the union variants for Value.
type ValueKind string

const (
	// ValueKindNumber identifies the number branch of the union.
	ValueKindNumber ValueKind = "number"
	// ValueKindText identifies the text branch of the union.
	ValueKindText ValueKind = "text"
)

// Kind returns the discriminator value of the union.
func (u Value) Kind() ValueKind {
	return u.kind
}

// NewValueNumber constructs a Value with the number branch set.
func NewValueNumber(v ValueNumber) Value {
	return Value{
		kind:   ValueKindNumber,
		Number: v,
	}
}

// AsNumber returns the value of the number branch if set.
func (u Value) AsNumber() (_ ValueNumber, ok bool) {
	if u.kind != ValueKindNumber {
		return
	}
	return u.Number, true
}

// SetNumber sets the number branch of the union.
func (u *Value) SetNumber(v ValueNumber) {
	u.kind = ValueKindNumber
	u.Number = v
}

// NewValueText constructs a Value with the text branch set.
func NewValueText(v ValueText) Value {
	return Value{
		kind: ValueKindText,
		Text: v,
	}
}

// AsText returns the value of the text branch if set.
func (u Value) AsText() (_ ValueText, ok bool) {
	if u.kind != ValueKindText {
		return
	}
	return u.Text, true
}

// SetText sets the text branch of the union.
func (u *Value) SetText(v ValueText) {
	u.kind = ValueKindText
	u.Text = v
}

// Validate ensures the union discriminant is valid.
func (u Value) Validate() error {
	switch u.kind {
	case "":
		return goa.InvalidEnumValueError("type", "", []any{
			string(ValueKindNumber),
			string(ValueKindText),
		})
	case ValueKindNumber:
		return nil
	case ValueKindText:
		return nil
	default:
		return goa.InvalidEnumValueError("type", u.kind, []any{
			string(ValueKindNumber),
			string(ValueKindText),
		})
	}
}

// MarshalJSON marshals the union into the canonical {type,value} JSON shape.
func (u Value) MarshalJSON() ([]byte, error) {
	if err := u.Validate(); err != nil {
		return nil, err
	}
	var (
		value any
	)
	switch u.kind {
	case ValueKindNumber:
		value = u.Number
	case ValueKindText:
		value = u.Text
	default:
		return nil, fmt.Errorf("unexpected Value discriminant %q", u.kind)
	}
	return json.Marshal(struct {
		Type  string `json:"type"`
		Value any    `json:"value"`
	}{
		Type:  string(u.kind),
		Value: value,
	})
}

// UnmarshalJSON unmarshals the union from the canonical {type,value} JSON shape.
func (u *Value) UnmarshalJSON(data []byte) error {
	var raw struct {
		Type  string          `json:"type"`
		Value json.RawMessage `json:"value"`
	}
	if err := json.Unmarshal(data, &raw); err != nil {
		return err
	}
	switch raw.Type {
	case string(ValueKindNumber):
		var v ValueNumber
		if err := json.Unmarshal(raw.Value, &v); err != nil {
			return err
		}
		u.kind = ValueKindNumber
		u.Number = v
	case string(ValueKindText):
		var v ValueText
		if err := json.Unmarshal(raw.Value, &v); err != nil {
			return err
		}
		u.kind = ValueKindText
		u.Text = v
	default:
		return fmt.Errorf("unexpected Value type %q", raw.Type)
	}
	return nil
}
