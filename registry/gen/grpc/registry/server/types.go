// Code generated by goa v3.23.1, DO NOT EDIT.
//
// registry gRPC server types
//
// Command:
// $ goa gen goa.design/goa-ai/registry/design -o registry

package server

import (
	"encoding/json"
	"unicode/utf8"

	registrypb "goa.design/goa-ai/registry/gen/grpc/registry/pb"
	registry "goa.design/goa-ai/registry/gen/registry"
	goa "goa.design/goa/v3/pkg"
	anypb "google.golang.org/protobuf/types/known/anypb"
	structpb "google.golang.org/protobuf/types/known/structpb"
)

// NewRegisterPayload builds the payload of the "Register" endpoint of the
// "registry" service from the gRPC request type.
func NewRegisterPayload(message *registrypb.RegisterRequest) *registry.RegisterPayload {
	v := &registry.RegisterPayload{
		Name:        message.Name,
		Description: message.Description,
		Version:     message.Version,
	}
	if message.Tags != nil {
		v.Tags = make([]string, len(message.Tags))
		for i, val := range message.Tags {
			v.Tags[i] = val
		}
	}
	if message.Tools != nil {
		v.Tools = make([]*registry.ToolSchema, len(message.Tools))
		for i, val := range message.Tools {
			v.Tools[i] = &registry.ToolSchema{
				Name:         val.Name,
				Description:  val.Description,
				InputSchema:  val.InputSchema,
				OutputSchema: val.OutputSchema,
			}
		}
	}
	return v
}

// NewProtoRegisterResponse builds the gRPC response type from the result of
// the "Register" endpoint of the "registry" service.
func NewProtoRegisterResponse(result *registry.RegisterResult) *registrypb.RegisterResponse {
	message := &registrypb.RegisterResponse{
		StreamId:     result.StreamID,
		RegisteredAt: result.RegisteredAt,
	}
	return message
}

// NewUnregisterPayload builds the payload of the "Unregister" endpoint of the
// "registry" service from the gRPC request type.
func NewUnregisterPayload(message *registrypb.UnregisterRequest) *registry.UnregisterPayload {
	v := &registry.UnregisterPayload{
		Name: message.Name,
	}
	return v
}

// NewProtoUnregisterResponse builds the gRPC response type from the result of
// the "Unregister" endpoint of the "registry" service.
func NewProtoUnregisterResponse() *registrypb.UnregisterResponse {
	message := &registrypb.UnregisterResponse{}
	return message
}

// NewEmitToolResultPayload builds the payload of the "EmitToolResult" endpoint
// of the "registry" service from the gRPC request type.
func NewEmitToolResultPayload(message *registrypb.EmitToolResultRequest) *registry.EmitToolResultPayload {
	v := &registry.EmitToolResultPayload{
		ToolUseID: message.ToolUseId,
		Result: func() any {
			if message.Result != nil {
				var value structpb.Value
				if err := message.Result.UnmarshalTo(&value); err == nil {
					if str := value.GetStringValue(); str != "" {
						var result any
						if err := json.Unmarshal([]byte(str), &result); err == nil {
							return result
						}
					}
				}
			}
			return nil
		}(),
	}
	if message.Error != nil {
		v.Error = protobufRegistrypbToolErrorToRegistryToolError(message.Error)
	}
	return v
}

// NewProtoEmitToolResultResponse builds the gRPC response type from the result
// of the "EmitToolResult" endpoint of the "registry" service.
func NewProtoEmitToolResultResponse() *registrypb.EmitToolResultResponse {
	message := &registrypb.EmitToolResultResponse{}
	return message
}

// NewPongPayload builds the payload of the "Pong" endpoint of the "registry"
// service from the gRPC request type.
func NewPongPayload(message *registrypb.PongRequest) *registry.PongPayload {
	v := &registry.PongPayload{
		PingID:  message.PingId,
		Toolset: message.Toolset,
	}
	return v
}

// NewProtoPongResponse builds the gRPC response type from the result of the
// "Pong" endpoint of the "registry" service.
func NewProtoPongResponse() *registrypb.PongResponse {
	message := &registrypb.PongResponse{}
	return message
}

// NewListToolsetsPayload builds the payload of the "ListToolsets" endpoint of
// the "registry" service from the gRPC request type.
func NewListToolsetsPayload(message *registrypb.ListToolsetsRequest) *registry.ListToolsetsPayload {
	v := &registry.ListToolsetsPayload{}
	if message.Tags != nil {
		v.Tags = make([]string, len(message.Tags))
		for i, val := range message.Tags {
			v.Tags[i] = val
		}
	}
	return v
}

// NewProtoListToolsetsResponse builds the gRPC response type from the result
// of the "ListToolsets" endpoint of the "registry" service.
func NewProtoListToolsetsResponse(result *registry.ListToolsetsResult) *registrypb.ListToolsetsResponse {
	message := &registrypb.ListToolsetsResponse{}
	if result.Toolsets != nil {
		message.Toolsets = make([]*registrypb.ToolsetInfo, len(result.Toolsets))
		for i, val := range result.Toolsets {
			message.Toolsets[i] = &registrypb.ToolsetInfo{
				Name:         val.Name,
				Description:  val.Description,
				Version:      val.Version,
				ToolCount:    int32(val.ToolCount),
				RegisteredAt: val.RegisteredAt,
			}
			if val.Tags != nil {
				message.Toolsets[i].Tags = make([]string, len(val.Tags))
				for j, val := range val.Tags {
					message.Toolsets[i].Tags[j] = val
				}
			}
		}
	}
	return message
}

// NewGetToolsetPayload builds the payload of the "GetToolset" endpoint of the
// "registry" service from the gRPC request type.
func NewGetToolsetPayload(message *registrypb.GetToolsetRequest) *registry.GetToolsetPayload {
	v := &registry.GetToolsetPayload{
		Name: message.Name,
	}
	return v
}

// NewProtoGetToolsetResponse builds the gRPC response type from the result of
// the "GetToolset" endpoint of the "registry" service.
func NewProtoGetToolsetResponse(result *registry.Toolset) *registrypb.GetToolsetResponse {
	message := &registrypb.GetToolsetResponse{
		Name:         result.Name,
		Description:  result.Description,
		Version:      result.Version,
		StreamId:     result.StreamID,
		RegisteredAt: result.RegisteredAt,
	}
	if result.Tags != nil {
		message.Tags = make([]string, len(result.Tags))
		for i, val := range result.Tags {
			message.Tags[i] = val
		}
	}
	if result.Tools != nil {
		message.Tools = make([]*registrypb.Tool, len(result.Tools))
		for i, val := range result.Tools {
			message.Tools[i] = &registrypb.Tool{
				Name:         val.Name,
				Description:  val.Description,
				InputSchema:  val.InputSchema,
				OutputSchema: val.OutputSchema,
			}
		}
	}
	return message
}

// NewSearchPayload builds the payload of the "Search" endpoint of the
// "registry" service from the gRPC request type.
func NewSearchPayload(message *registrypb.SearchRequest) *registry.SearchPayload {
	v := &registry.SearchPayload{
		Query: message.Query,
	}
	return v
}

// NewProtoSearchResponse builds the gRPC response type from the result of the
// "Search" endpoint of the "registry" service.
func NewProtoSearchResponse(result *registry.SearchResult) *registrypb.SearchResponse {
	message := &registrypb.SearchResponse{}
	if result.Toolsets != nil {
		message.Toolsets = make([]*registrypb.ToolsetInfo, len(result.Toolsets))
		for i, val := range result.Toolsets {
			message.Toolsets[i] = &registrypb.ToolsetInfo{
				Name:         val.Name,
				Description:  val.Description,
				Version:      val.Version,
				ToolCount:    int32(val.ToolCount),
				RegisteredAt: val.RegisteredAt,
			}
			if val.Tags != nil {
				message.Toolsets[i].Tags = make([]string, len(val.Tags))
				for j, val := range val.Tags {
					message.Toolsets[i].Tags[j] = val
				}
			}
		}
	}
	return message
}

// NewCallToolPayload builds the payload of the "CallTool" endpoint of the
// "registry" service from the gRPC request type.
func NewCallToolPayload(message *registrypb.CallToolRequest) *registry.CallToolPayload {
	v := &registry.CallToolPayload{
		Toolset: message.Toolset,
		Tool:    message.Tool,
		Payload: func() any {
			if message.Payload != nil {
				var value structpb.Value
				if err := message.Payload.UnmarshalTo(&value); err == nil {
					if str := value.GetStringValue(); str != "" {
						var result any
						if err := json.Unmarshal([]byte(str), &result); err == nil {
							return result
						}
					}
				}
			}
			return nil
		}(),
	}
	return v
}

// NewProtoCallToolResponse builds the gRPC response type from the result of
// the "CallTool" endpoint of the "registry" service.
func NewProtoCallToolResponse(result *registry.CallToolResult) *registrypb.CallToolResponse {
	message := &registrypb.CallToolResponse{
		ToolUseId: result.ToolUseID,
		Result: func() *anypb.Any {
			if result.Result == nil {
				return nil
			}
			// Convert Go any to protobuf Any using JSON marshaling
			if jsonData, err := json.Marshal(result.Result); err == nil {
				if data, err := anypb.New(&structpb.Value{
					Kind: &structpb.Value_StringValue{StringValue: string(jsonData)},
				}); err == nil {
					return data
				}
			}
			return nil
		}(),
	}
	if result.Error != nil {
		message.Error = svcRegistryToolErrorToRegistrypbToolError(result.Error)
	}
	return message
}

// ValidateRegisterRequest runs the validations defined on RegisterRequest.
func ValidateRegisterRequest(message *registrypb.RegisterRequest) (err error) {
	if message.Tools == nil {
		err = goa.MergeErrors(err, goa.MissingFieldError("tools", "message"))
	}
	if utf8.RuneCountInString(message.Name) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.name", message.Name, utf8.RuneCountInString(message.Name), 1, true))
	}
	if utf8.RuneCountInString(message.Name) > 256 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.name", message.Name, utf8.RuneCountInString(message.Name), 256, false))
	}
	if message.Description != nil {
		if utf8.RuneCountInString(*message.Description) > 4096 {
			err = goa.MergeErrors(err, goa.InvalidLengthError("message.description", *message.Description, utf8.RuneCountInString(*message.Description), 4096, false))
		}
	}
	if message.Version != nil {
		err = goa.MergeErrors(err, goa.ValidatePattern("message.version", *message.Version, "^v?\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"))
	}
	for _, e := range message.Tools {
		if e != nil {
			if err2 := ValidateToolSchema(e); err2 != nil {
				err = goa.MergeErrors(err, err2)
			}
		}
	}
	return
}

// ValidateToolSchema runs the validations defined on ToolSchema.
func ValidateToolSchema(elem *registrypb.ToolSchema) (err error) {
	if utf8.RuneCountInString(elem.Name) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("elem.name", elem.Name, utf8.RuneCountInString(elem.Name), 1, true))
	}
	return
}

// ValidateUnregisterRequest runs the validations defined on UnregisterRequest.
func ValidateUnregisterRequest(message *registrypb.UnregisterRequest) (err error) {
	if utf8.RuneCountInString(message.Name) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.name", message.Name, utf8.RuneCountInString(message.Name), 1, true))
	}
	return
}

// ValidateEmitToolResultRequest runs the validations defined on
// EmitToolResultRequest.
func ValidateEmitToolResultRequest(message *registrypb.EmitToolResultRequest) (err error) {
	if utf8.RuneCountInString(message.ToolUseId) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.tool_use_id", message.ToolUseId, utf8.RuneCountInString(message.ToolUseId), 1, true))
	}
	return
}

// ValidatePongRequest runs the validations defined on PongRequest.
func ValidatePongRequest(message *registrypb.PongRequest) (err error) {
	if utf8.RuneCountInString(message.PingId) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.ping_id", message.PingId, utf8.RuneCountInString(message.PingId), 1, true))
	}
	if utf8.RuneCountInString(message.Toolset) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.toolset", message.Toolset, utf8.RuneCountInString(message.Toolset), 1, true))
	}
	return
}

// ValidateGetToolsetRequest runs the validations defined on GetToolsetRequest.
func ValidateGetToolsetRequest(message *registrypb.GetToolsetRequest) (err error) {
	if utf8.RuneCountInString(message.Name) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.name", message.Name, utf8.RuneCountInString(message.Name), 1, true))
	}
	return
}

// ValidateSearchRequest runs the validations defined on SearchRequest.
func ValidateSearchRequest(message *registrypb.SearchRequest) (err error) {
	if utf8.RuneCountInString(message.Query) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.query", message.Query, utf8.RuneCountInString(message.Query), 1, true))
	}
	if utf8.RuneCountInString(message.Query) > 1024 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.query", message.Query, utf8.RuneCountInString(message.Query), 1024, false))
	}
	return
}

// ValidateCallToolRequest runs the validations defined on CallToolRequest.
func ValidateCallToolRequest(message *registrypb.CallToolRequest) (err error) {
	if utf8.RuneCountInString(message.Toolset) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.toolset", message.Toolset, utf8.RuneCountInString(message.Toolset), 1, true))
	}
	if utf8.RuneCountInString(message.Tool) < 1 {
		err = goa.MergeErrors(err, goa.InvalidLengthError("message.tool", message.Tool, utf8.RuneCountInString(message.Tool), 1, true))
	}
	return
}

// protobufRegistrypbToolErrorToRegistryToolError builds a value of type
// *registry.ToolError from a value of type *registrypb.ToolError.
func protobufRegistrypbToolErrorToRegistryToolError(v *registrypb.ToolError) *registry.ToolError {
	if v == nil {
		return nil
	}
	res := &registry.ToolError{
		Code:    v.Code,
		Message: v.Message_,
	}

	return res
}

// svcRegistryToolErrorToRegistrypbToolError builds a value of type
// *registrypb.ToolError from a value of type *registry.ToolError.
func svcRegistryToolErrorToRegistrypbToolError(v *registry.ToolError) *registrypb.ToolError {
	if v == nil {
		return nil
	}
	res := &registrypb.ToolError{
		Code:     v.Code,
		Message_: v.Message,
	}

	return res
}
