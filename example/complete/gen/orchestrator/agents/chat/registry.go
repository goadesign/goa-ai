// Code generated by goa v3.22.6, DO NOT EDIT.
//
// ChatAgent registry
//
// Command:
// $ goa gen example.com/assistant/design

package chat

import (
	"context"
	"errors"
	"fmt"
	"time"

	assistant_mcp "example.com/assistant/gen/orchestrator/agents/chat/assistant_mcp"
	specs "example.com/assistant/gen/orchestrator/agents/chat/specs"
	"goa.design/goa-ai/runtime/agent/engine"
	agentsruntime "goa.design/goa-ai/runtime/agent/runtime"
)

// RegisterChatAgent registers the generated agent components with the runtime.
func RegisterChatAgent(ctx context.Context, rt *agentsruntime.Runtime, cfg ChatAgentConfig) error {
	if rt == nil {
		return errors.New("runtime is required")
	}
	agent, err := NewChatAgent(cfg)
	if err != nil {
		return err
	}
	if err := rt.RegisterAgent(ctx, agentsruntime.AgentRegistration{
		ID:       "orchestrator.chat",
		Planner:  agent.Planner,
		Workflow: ChatWorkflowDefinition,
		Activities: []engine.ActivityDefinition{
			ChatPlanActivityDefinition,
			ChatResumeActivityDefinition,
			ChatExecuteToolActivityDefinition,
		},
		PlanActivityName: "orchestrator.chat.plan",
		PlanActivityOptions: engine.ActivityOptions{
			Queue:   "orchestrator_chat_workflow",
			Timeout: time.Duration(120000000000),
			RetryPolicy: engine.RetryPolicy{
				MaxAttempts:        3,
				InitialInterval:    time.Duration(1000000000),
				BackoffCoefficient: 2,
			},
		},
		ResumeActivityName: "orchestrator.chat.resume",
		ResumeActivityOptions: engine.ActivityOptions{
			Queue:   "orchestrator_chat_workflow",
			Timeout: time.Duration(120000000000),
			RetryPolicy: engine.RetryPolicy{
				MaxAttempts:        3,
				InitialInterval:    time.Duration(1000000000),
				BackoffCoefficient: 2,
			},
		},
		ExecuteToolActivity: "orchestrator.chat.executetool",
		Specs:               specs.Specs,
		Policy:              agentsruntime.RunPolicy{},
	}); err != nil {
		return err
	}
	// Register external MCP toolsets using local executors and callers from config.
	if cfg.MCPCallers == nil {
		return fmt.Errorf("mcp callers are required for agent %s", "orchestrator.chat")
	}
	{
		caller := cfg.MCPCallers[ChatAssistantAssistantMcpToolsetID]
		if caller == nil {
			return fmt.Errorf("mcp caller for %s is required", ChatAssistantAssistantMcpToolsetID)
		}
		exec := assistant_mcp.NewChatAssistantMcpMCPExecutor(caller)
		if err := rt.RegisterToolset(assistant_mcp.NewChatAssistantMcpToolsetRegistration(exec)); err != nil {
			return err
		}
	}

	// Service toolsets are registered by application code using executors.
	return nil
}
