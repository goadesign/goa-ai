// Code generated by goa v3.22.6, DO NOT EDIT.
//
// orchestrator JSON-RPC server encoders and decoders
//
// Command:
// $ goa gen example.com/assistant/design

package server

import (
	"bytes"
	"context"
	"errors"
	"io"
	"net/http"

	orchestrator "example.com/assistant/gen/orchestrator"
	goahttp "goa.design/goa/v3/http"
	"goa.design/goa/v3/jsonrpc"
	goa "goa.design/goa/v3/pkg"
)

// EncodeRunResponse returns an encoder for responses returned by the
// orchestrator run endpoint.
func EncodeRunResponse(encoder func(context.Context, http.ResponseWriter) goahttp.Encoder) func(context.Context, http.ResponseWriter, any) error {
	return func(ctx context.Context, w http.ResponseWriter, v any) error {
		res, _ := v.(*orchestrator.AgentRunChunk)
		enc := encoder(ctx, w)
		body := NewRunResponseBody(res)
		w.WriteHeader(http.StatusOK)
		return enc.Encode(body)
	}
}

// DecodeRunRequest returns a decoder for requests sent to the orchestrator run
// endpoint.
func DecodeRunRequest(mux goahttp.Muxer, decoder func(*http.Request) goahttp.Decoder) func(*http.Request, *jsonrpc.RawRequest) (*orchestrator.AgentRunPayload, error) {
	return func(r *http.Request, req *jsonrpc.RawRequest) (*orchestrator.AgentRunPayload, error) {
		r.Body = io.NopCloser(bytes.NewReader(req.Params))
		var (
			body RunRequestBody
			err  error
		)
		err = decoder(r).Decode(&body)
		if err != nil {
			if errors.Is(err, io.EOF) {
				var zero *orchestrator.AgentRunPayload
				return zero, goa.MissingPayloadError()
			}
			var gerr *goa.ServiceError
			if errors.As(err, &gerr) {
				var zero *orchestrator.AgentRunPayload
				return zero, gerr
			}
			var zero *orchestrator.AgentRunPayload
			return zero, goa.DecodePayloadError(err.Error())
		}
		err = ValidateRunRequestBody(&body)
		if err != nil {
			var zero *orchestrator.AgentRunPayload
			return zero, err
		}
		payload := NewRunAgentRunPayload(&body)

		return payload, nil
	}
}

// unmarshalAgentMessageRequestBodyToOrchestratorAgentMessage builds a value of
// type *orchestrator.AgentMessage from a value of type
// *AgentMessageRequestBody.
func unmarshalAgentMessageRequestBodyToOrchestratorAgentMessage(v *AgentMessageRequestBody) *orchestrator.AgentMessage {
	res := &orchestrator.AgentMessage{
		Role:    *v.Role,
		Content: *v.Content,
	}
	if v.Meta != nil {
		res.Meta = make(map[string]any, len(v.Meta))
		for key, val := range v.Meta {
			tk := key
			tv := val
			res.Meta[tk] = tv
		}
	}

	return res
}

// marshalOrchestratorAgentToolCallChunkToAgentToolCallChunkResponseBody builds
// a value of type *AgentToolCallChunkResponseBody from a value of type
// *orchestrator.AgentToolCallChunk.
func marshalOrchestratorAgentToolCallChunkToAgentToolCallChunkResponseBody(v *orchestrator.AgentToolCallChunk) *AgentToolCallChunkResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentToolCallChunkResponseBody{
		ID:      v.ID,
		Name:    v.Name,
		Payload: v.Payload,
	}

	return res
}

// marshalOrchestratorAgentToolResultChunkToAgentToolResultChunkResponseBody
// builds a value of type *AgentToolResultChunkResponseBody from a value of
// type *orchestrator.AgentToolResultChunk.
func marshalOrchestratorAgentToolResultChunkToAgentToolResultChunkResponseBody(v *orchestrator.AgentToolResultChunk) *AgentToolResultChunkResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentToolResultChunkResponseBody{
		ID:     v.ID,
		Result: v.Result,
	}
	if v.Error != nil {
		res.Error = marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody(v.Error)
	}

	return res
}

// marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody builds a value
// of type *AgentToolErrorResponseBody from a value of type
// *orchestrator.AgentToolError.
func marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody(v *orchestrator.AgentToolError) *AgentToolErrorResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentToolErrorResponseBody{
		Message: v.Message,
	}
	if v.Cause != nil {
		res.Cause = marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody(v.Cause)
	}

	return res
}

// marshalOrchestratorAgentRunStatusChunkToAgentRunStatusChunkResponseBody
// builds a value of type *AgentRunStatusChunkResponseBody from a value of type
// *orchestrator.AgentRunStatusChunk.
func marshalOrchestratorAgentRunStatusChunkToAgentRunStatusChunkResponseBody(v *orchestrator.AgentRunStatusChunk) *AgentRunStatusChunkResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentRunStatusChunkResponseBody{
		State:   v.State,
		Message: v.Message,
	}

	return res
}
