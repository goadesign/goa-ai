// Code generated by goa v3.22.6, DO NOT EDIT.
//
// ChatAgent registry
//
// Command:
// $ goa gen example.com/assistant/design

package chat

import (
	"context"
	"errors"
	"fmt"
	"time"

	mcpassistant "example.com/assistant/gen/mcp_assistant"
	tool_specs "example.com/assistant/gen/orchestrator/agents/chat/tool_specs"
	"goa.design/goa-ai/agents/runtime/engine"
	agentsruntime "goa.design/goa-ai/agents/runtime/runtime"
)

// RegisterChatAgent registers the generated agent components with the runtime.
func RegisterChatAgent(ctx context.Context, rt *agentsruntime.Runtime, cfg ChatAgentConfig) error {
	if rt == nil {
		return errors.New("runtime is required")
	}
	agent, err := NewChatAgent(cfg)
	if err != nil {
		return err
	}
	if err := rt.RegisterAgent(ctx, agentsruntime.AgentRegistration{
		ID:       "orchestrator.chat",
		Planner:  agent.Planner,
		Workflow: ChatWorkflowDefinition,
		Activities: []engine.ActivityDefinition{
			ChatPlanActivityDefinition,
			ChatResumeActivityDefinition,
			ChatExecuteToolActivityDefinition,
		},
		PlanActivityName: "orchestrator.chat.plan",
		PlanActivityOptions: engine.ActivityOptions{
			Queue:   "orchestrator_chat_workflow",
			Timeout: time.Duration(120000000000),
			RetryPolicy: engine.RetryPolicy{
				MaxAttempts:        3,
				InitialInterval:    time.Duration(1000000000),
				BackoffCoefficient: 2,
			},
		},
		ResumeActivityName: "orchestrator.chat.resume",
		ResumeActivityOptions: engine.ActivityOptions{
			Queue:   "orchestrator_chat_workflow",
			Timeout: time.Duration(120000000000),
			RetryPolicy: engine.RetryPolicy{
				MaxAttempts:        3,
				InitialInterval:    time.Duration(1000000000),
				BackoffCoefficient: 2,
			},
		},
		ExecuteToolActivity: "orchestrator.chat.executetool",
		Specs:               tool_specs.Specs,
		Policy:              agentsruntime.RunPolicy{},
	}); err != nil {
		return err
	}

	// Auto-register service toolsets for method-backed tools.
	if cfg.MCPCallers == nil {
		return fmt.Errorf("mcp callers are required for agent %s", "orchestrator.chat")
	}
	if caller := cfg.MCPCallers[ChatAssistantAssistantMcpToolsetID]; caller == nil {
		return fmt.Errorf("mcp caller for %s is required", ChatAssistantAssistantMcpToolsetID)
	} else if err := mcpassistant.RegisterAssistantAssistantMcpToolset(ctx, rt, caller); err != nil {
		return fmt.Errorf("register mcp toolset %s: %w", ChatAssistantAssistantMcpToolsetID, err)
	}

	return nil
}
