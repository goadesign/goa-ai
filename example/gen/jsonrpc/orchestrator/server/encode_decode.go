// Code generated by goa v3.22.6, DO NOT EDIT.
//
// orchestrator JSON-RPC server encoders and decoders
//
// Command:
// $ goa gen example.com/assistant/design

package server

import (
	"bytes"
	"context"
	"errors"
	"io"
	"net/http"

	orchestrator "example.com/assistant/gen/orchestrator"
	goahttp "goa.design/goa/v3/http"
	"goa.design/goa/v3/jsonrpc"
	goa "goa.design/goa/v3/pkg"
)

// EncodeRunResponse returns an encoder for responses returned by the
// orchestrator run endpoint.
func EncodeRunResponse(encoder func(context.Context, http.ResponseWriter) goahttp.Encoder) func(context.Context, http.ResponseWriter, any) error {
	return func(ctx context.Context, w http.ResponseWriter, v any) error {
		res, _ := v.(*orchestrator.AgentRunResult)
		enc := encoder(ctx, w)
		body := NewRunResponseBody(res)
		w.WriteHeader(http.StatusOK)
		return enc.Encode(body)
	}
}

// DecodeRunRequest returns a decoder for requests sent to the orchestrator run
// endpoint.
func DecodeRunRequest(mux goahttp.Muxer, decoder func(*http.Request) goahttp.Decoder) func(*http.Request, *jsonrpc.RawRequest) (*orchestrator.AgentRunPayload, error) {
	return func(r *http.Request, req *jsonrpc.RawRequest) (*orchestrator.AgentRunPayload, error) {
		r.Body = io.NopCloser(bytes.NewReader(req.Params))
		var (
			body RunRequestBody
			err  error
		)
		err = decoder(r).Decode(&body)
		if err != nil {
			if errors.Is(err, io.EOF) {
				var zero *orchestrator.AgentRunPayload
				return zero, goa.MissingPayloadError()
			}
			var gerr *goa.ServiceError
			if errors.As(err, &gerr) {
				var zero *orchestrator.AgentRunPayload
				return zero, gerr
			}
			var zero *orchestrator.AgentRunPayload
			return zero, goa.DecodePayloadError(err.Error())
		}
		err = ValidateRunRequestBody(&body)
		if err != nil {
			var zero *orchestrator.AgentRunPayload
			return zero, err
		}
		payload := NewRunAgentRunPayload(&body)

		return payload, nil
	}
}

// unmarshalAgentMessageRequestBodyToOrchestratorAgentMessage builds a value of
// type *orchestrator.AgentMessage from a value of type
// *AgentMessageRequestBody.
func unmarshalAgentMessageRequestBodyToOrchestratorAgentMessage(v *AgentMessageRequestBody) *orchestrator.AgentMessage {
	res := &orchestrator.AgentMessage{
		Role:    *v.Role,
		Content: *v.Content,
	}
	if v.Meta != nil {
		res.Meta = make(map[string]any, len(v.Meta))
		for key, val := range v.Meta {
			tk := key
			tv := val
			res.Meta[tk] = tv
		}
	}

	return res
}

// marshalOrchestratorAgentMessageToAgentMessageResponseBody builds a value of
// type *AgentMessageResponseBody from a value of type
// *orchestrator.AgentMessage.
func marshalOrchestratorAgentMessageToAgentMessageResponseBody(v *orchestrator.AgentMessage) *AgentMessageResponseBody {
	res := &AgentMessageResponseBody{
		Role:    v.Role,
		Content: v.Content,
	}
	if v.Meta != nil {
		res.Meta = make(map[string]any, len(v.Meta))
		for key, val := range v.Meta {
			tk := key
			tv := val
			res.Meta[tk] = tv
		}
	}

	return res
}

// marshalOrchestratorAgentToolEventToAgentToolEventResponseBody builds a value
// of type *AgentToolEventResponseBody from a value of type
// *orchestrator.AgentToolEvent.
func marshalOrchestratorAgentToolEventToAgentToolEventResponseBody(v *orchestrator.AgentToolEvent) *AgentToolEventResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentToolEventResponseBody{
		Name:    v.Name,
		Payload: v.Payload,
	}
	if v.Error != nil {
		res.Error = marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody(v.Error)
	}
	if v.RetryHint != nil {
		res.RetryHint = marshalOrchestratorAgentRetryHintToAgentRetryHintResponseBody(v.RetryHint)
	}
	if v.Telemetry != nil {
		res.Telemetry = marshalOrchestratorAgentToolTelemetryToAgentToolTelemetryResponseBody(v.Telemetry)
	}

	return res
}

// marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody builds a value
// of type *AgentToolErrorResponseBody from a value of type
// *orchestrator.AgentToolError.
func marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody(v *orchestrator.AgentToolError) *AgentToolErrorResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentToolErrorResponseBody{
		Message: v.Message,
	}
	if v.Cause != nil {
		res.Cause = marshalOrchestratorAgentToolErrorToAgentToolErrorResponseBody(v.Cause)
	}

	return res
}

// marshalOrchestratorAgentRetryHintToAgentRetryHintResponseBody builds a value
// of type *AgentRetryHintResponseBody from a value of type
// *orchestrator.AgentRetryHint.
func marshalOrchestratorAgentRetryHintToAgentRetryHintResponseBody(v *orchestrator.AgentRetryHint) *AgentRetryHintResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentRetryHintResponseBody{
		Reason:             v.Reason,
		Tool:               v.Tool,
		RestrictToTool:     v.RestrictToTool,
		ClarifyingQuestion: v.ClarifyingQuestion,
		Message:            v.Message,
	}
	if v.MissingFields != nil {
		res.MissingFields = make([]string, len(v.MissingFields))
		for i, val := range v.MissingFields {
			res.MissingFields[i] = val
		}
	}
	if v.ExampleInput != nil {
		res.ExampleInput = make(map[string]any, len(v.ExampleInput))
		for key, val := range v.ExampleInput {
			tk := key
			tv := val
			res.ExampleInput[tk] = tv
		}
	}
	if v.PriorInput != nil {
		res.PriorInput = make(map[string]any, len(v.PriorInput))
		for key, val := range v.PriorInput {
			tk := key
			tv := val
			res.PriorInput[tk] = tv
		}
	}

	return res
}

// marshalOrchestratorAgentToolTelemetryToAgentToolTelemetryResponseBody builds
// a value of type *AgentToolTelemetryResponseBody from a value of type
// *orchestrator.AgentToolTelemetry.
func marshalOrchestratorAgentToolTelemetryToAgentToolTelemetryResponseBody(v *orchestrator.AgentToolTelemetry) *AgentToolTelemetryResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentToolTelemetryResponseBody{
		DurationMs: v.DurationMs,
		TokensUsed: v.TokensUsed,
		Model:      v.Model,
	}
	if v.Extra != nil {
		res.Extra = make(map[string]any, len(v.Extra))
		for key, val := range v.Extra {
			tk := key
			tv := val
			res.Extra[tk] = tv
		}
	}

	return res
}

// marshalOrchestratorAgentPlannerAnnotationToAgentPlannerAnnotationResponseBody
// builds a value of type *AgentPlannerAnnotationResponseBody from a value of
// type *orchestrator.AgentPlannerAnnotation.
func marshalOrchestratorAgentPlannerAnnotationToAgentPlannerAnnotationResponseBody(v *orchestrator.AgentPlannerAnnotation) *AgentPlannerAnnotationResponseBody {
	if v == nil {
		return nil
	}
	res := &AgentPlannerAnnotationResponseBody{
		Text: v.Text,
	}
	if v.Labels != nil {
		res.Labels = make(map[string]string, len(v.Labels))
		for key, val := range v.Labels {
			tk := key
			tv := val
			res.Labels[tk] = tv
		}
	}

	return res
}
