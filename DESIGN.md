## MCP Plugin for Goa

Build MCP servers from your Goa designs with almost no extra work. This plugin reuses Goa’s service and JSON‑RPC generators, adds a thin MCP layer, and places the results under a clean MCP directory layout.

### What you get
- MCP endpoints mapped from your Goa service (tools, resources, prompts)
- JSON‑RPC transport for MCP (SSE included when methods stream)
- JSON‑RPC client CLI for MCP services
- Small helper files to make wiring straightforward

### How it works
For each service annotated with MCP, the plugin:
1) Derives a temporary MCP‑specific service expression from your DSL (see `expr/mcp.go`).
2) Runs standard Goa generators:
   - Service layer via `codegen/service` (service, endpoints, client)
   - JSON‑RPC transport via `jsonrpc/codegen` (server, client, types; SSE when streaming)
   - JSON‑RPC client CLI via `jsonrpccodegen.ClientCLIFiles`
3) Applies small, deterministic transformations so files land under MCP paths and import MCP packages.

We compose on top of Goa—no forks, minimal templates, and predictable output.

### Layout
- Service layer (kept as generated by Goa)
- JSON‑RPC for MCP: `gen/jsonrpc/mcp/<service>/...`
- HTTP paths duplicated for MCP clients: `gen/http/mcp/<service>/client/paths.go`

Note: Goa ultimately decides filenames; we transform whatever it emits into the MCP layout.

### Streaming
No custom streaming templates. When your methods stream, Goa’s JSON‑RPC generator emits the SSE stack. We simply adjust paths/imports so it lives under the MCP tree.

### Cross‑platform paths
All path checks and rewrites go through `codegen/pathutil.go`:
- `normalize` for comparisons, `replaceFirst` for targeted rewrites, `join` for building paths
- No scattered `filepath.ToSlash/FromSlash` in generation code

### Header updates
We use an `updateHeader` helper (modeled after Goa) to tweak file headers:
- Change titles from “HTTP” → “JSON‑RPC” where appropriate
- Rewrite imports from `gen/http` → `gen/jsonrpc`
- Point service imports at the MCP package: `gen/<service>` → `gen/mcp/<service>` (for the current service alias)
- Add the MCP HTTP client paths import for JSON‑RPC `client/encode_decode.go`

### Pure MCP mode (experimental)
Some projects want MCP‑only services. We support this behind a filter:
- `IsPureMCPService` detects services where every method is mapped to MCP
- `filterForPureMCP` removes non‑MCP transport outputs for those services

### Limits and next steps
- Dedicated MCP encode/decode and client/CLI helpers are placeholders; we plan to reuse Goa’s encode/decode and CLI generators where needed
- Mixed (MCP + other transports) ergonomics will evolve; for now we bias toward clear separation

### Contributing
- Add MCP concepts in `expr/mcp.go` and update the MCP expression builder
- Customize header imports or titles in `updateHeader` (`codegen/generate.go`)
- Keep new templates small and transport‑agnostic; compose on Goa JSON‑RPC outputs

### Summary
This plugin gives you MCP with familiar Goa patterns, minimal surface area, and a directory layout that feels natural. It’s accurate, easy to maintain, and designed to evolve alongside Goa.


